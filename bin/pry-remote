#!/usr/bin/env coffee

net = require("net")
_ = require("underscore")
SyncPrompt = require("#{__dirname}/../src/pry/sync_prompt")

prompt = new SyncPrompt()

socket = net.connect(port: 8124)
socket.on 'end', ->
  process.kill()

socket.on 'data', (data) ->
  data = JSON.parse(data.toString().split('\0')[0])
  if _.contains(_.keys(data), 'output')
    console.log(data.output[0])
    prompt.open()

prompt.on 'data', (line, chain) ->
  socket.write JSON.stringify({input: line}) + "\0"

prompt.type('whereami')
